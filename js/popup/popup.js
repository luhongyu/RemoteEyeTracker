// Copyright (c) 2012 The Chromium Authors. All rights reserved.// Use of this source code is governed by a BSD-style license that can be// found in the LICENSE file.let background = chrome.extension.getBackgroundPage();let USER_ID = background.USER_ID;$(function () {    if (USER_ID === "default"){        while (USER_ID === "default"){            var username = prompt("Please enter your name:");            if (username){                background.USER_ID = username;                console.log(username);                USER_ID = username;                background.localStorage.setItem("USER_ID", USER_ID);            }else{                alert("Input Wrong!");            }        }    }    showState();    listRecords();    $("#begin").click(function () {        begin();    });    $("#end").click(function () {        end();    });    $('#rec').live('click',function(){        console.log($(this).text());        replay($(this).text());    });    $("#submit").click(function () {        listUserRecords();    });    $("#logurl").live('click', function () {    })});function showState() {    let state = background.getState();    if (state === "IN_RECORDING"){        $("#state").val("In Recording");    }else{        $("#state").val("Not Recording");    }}function listRecords() {    chrome.tabs.getSelected(null, function(tab){        let nowtab = hashUrl(tab.url);        let logrecords = background.getRecordNames(nowtab);        console.log(logrecords);        let loglist = $("#loglist");        loglist.empty();        for (let i = 0; i < logrecords.length; i++){            loglist.append("<li><a id='rec' href='javascript:void(0)'>" + logrecords[i] + "</a></li>");        }    });}function listUserRecords() {    let user_records = background.getUserRecords();    let loglist = $("#logrecords");    loglist.empty();    for (let i = 0; i < user_records.length; i++){        loglist.append('<tr><th><input type="checkbox" value=""/></th><td>' + '<a id="logurl" href="' + user_records[i].url + '">' + user_records[i].url.substr(0, 25) + '</a></td><td>' + user_records[i].log_name + '</td></tr>');    }    $(".log-table").show();}function begin() {    chrome.extension.sendMessage({        key: "LOG_BEGIN"    });    chrome.tabs.executeScript(null, {code: 'localStorage.setItem("GLOBAL_KEY", "true")'});}function end() {    chrome.extension.sendMessage({        key: "LOG_END"    });    chrome.tabs.executeScript(null, {code: 'localStorage.setItem("GLOBAL_KEY", "false")'});}function replay(logname) {    chrome.tabs.getSelected(null, function(tab) {        var loglist = background.getPageRecord(tab, logname);        var codestr = "replay(JSON.parse('" + JSON.stringify(loglist)+  "'));";        console.log(codestr);        chrome.tabs.executeScript(null,            {code: codestr}        );        $("#state").val("replaying")    });}