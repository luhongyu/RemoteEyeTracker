/** * Created by luhongyu on 2017/7/5. * * TODO: 1. chose items in log list and submit */let background = chrome.extension.getBackgroundPage();let USER_ID = background.USER_ID;$(function () {    if (USER_ID === "default"){        setUserID();    }    showState(); // show state of the page    listRecords(); // list records of the page    $("#begin").click(function () { logBegin(); });    $("#end").click(function () { logEnd(); });    $('#rec').live('click',function(){ replay($(this).text()); });    $("#submit").click(function () { listUserRecords(); });    // TODO: chose items in log list and submit    $("#logurl").live('click', function () {    })});function setUserID() {    while (USER_ID === "default"){        var username = prompt("Please enter your name:");        if (username){            background.USER_ID = username;            console.log(username);            USER_ID = username;            background.localStorage.setItem("USER_ID", USER_ID);        }else{            alert("Input Wrong!");        }    }}function showState() {    let state = background.getPageRecordState();    if (state === "IN_RECORDING"){        $("#state").val("In Recording");    }else{        $("#state").val("Not Recording");    }}function listRecords() {    chrome.tabs.getSelected(null, function(tab){        let nowtab = hashUrl(tab.url);        let logrecords = background.getPageRecordNames(nowtab);        console.log(logrecords);        let loglist = $("#loglist");        loglist.empty();        for (let i = 0; i < logrecords.length; i++){            loglist.append("<li><a id='rec' href='javascript:void(0)'>" + logrecords[i] + "</a></li>");        }    });}function listUserRecords() {    let user_records = background.getUserRecords();    let loglist = $("#logrecords");    loglist.empty();    for (let i = 0; i < user_records.length; i++){        loglist.append('<tr><th><input type="checkbox" value=""/></th><td>' + '<a id="logurl" href="' + user_records[i].url + '">' + user_records[i].url.substr(0, 25) + '</a></td><td>' + user_records[i].log_name + '</td></tr>');    }    $(".log-table").show();}function logBegin() {    chrome.extension.sendMessage({        key: "LOG_BEGIN"    });    chrome.tabs.executeScript(null, {code: 'localStorage.setItem("GLOBAL_KEY", "true")'});}function logEnd() {    chrome.extension.sendMessage({        key: "LOG_END"    });    chrome.tabs.executeScript(null, {code: 'localStorage.setItem("GLOBAL_KEY", "false")'});}function replay(logname) {    chrome.tabs.getSelected(null, function(tab) {        var loglist = background.getRecordData(tab, logname);        var codestr = "replay(JSON.parse('" + JSON.stringify(loglist)+  "'));";        console.log(codestr);        chrome.tabs.executeScript(null,            {code: codestr}        );        $("#state").val("replaying")    });}